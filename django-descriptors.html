<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/app.b6f197430f783b3e67aa.css">code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><meta name="generator" content="Gatsby 2.1.0"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">Django Model Descriptors | Kevin Stone</title><meta data-react-helmet="true" name="description" content="How can we enhance our Django model fields to act beyond simple database types
to encapsulate their associated business logic? Leveraging…"/><meta data-react-helmet="true" property="og:title" content="Django Model Descriptors"/><meta data-react-helmet="true" property="og:description" content="How can we enhance our Django model fields to act beyond simple database types
to encapsulate their associated business logic? Leveraging…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Kevin Stone"/><meta data-react-helmet="true" name="twitter:title" content="Django Model Descriptors"/><meta data-react-helmet="true" name="twitter:description" content="How can we enhance our Django model fields to act beyond simple database types
to encapsulate their associated business logic? Leveraging…"/><meta data-react-helmet="true" name="keywords" content="Django, Python"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.78 'Merriweather','Georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.9);font-family:'Merriweather','Georgia',serif;font-weight:300;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2.2974rem;line-height:2.67rem;letter-spacing:-2px;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;color:inherit;font-family:'Open Sans',sans-serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;font-style:italic;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}ul{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;list-style:disc;}ol{margin-left:1.78rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:0.85rem;line-height:1.78rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1rem;line-height:1.78rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}blockquote{margin-left:0;margin-right:1.78rem;margin-top:0;padding-bottom:0;padding-left:1.44625rem;padding-right:0;padding-top:0;margin-bottom:1.78rem;font-size:1.1487rem;line-height:1.78rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.33375rem solid hsla(0,0%,0%,0.2);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.78rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.78rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.78rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}li > ul{margin-left:1.78rem;margin-bottom:calc(1.78rem / 2);margin-top:calc(1.78rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.78rem / 2);}code{font-size:0.917rem;line-height:1.78rem;border-radius:2px;color:rgba(26,26,26,0.9);background-color:#f5f5f5;padding:0.2225rem;}kbd{font-size:0.85rem;line-height:1.78rem;}samp{font-size:0.85rem;line-height:1.78rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.18667rem;padding-right:1.18667rem;padding-top:0.89rem;padding-bottom:calc(0.89rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#ff6f69;text-decoration:none;}a:hover,a:active{text-decoration:underline;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.78rem;color:hsla(0,0%,0%,0.9);font-weight:300;}blockquote cite:before{content:"— ";}ul,ol{margin-left:0;}@media only screen and (max-width:480px){ul,ol{margin-left:1.78rem;}blockquote{margin-left:-1.335rem;margin-right:0;padding-left:1.00125rem;}}@media only screen and (max-width:768px){h1{font-size:2rem;line-height:2.67rem;}}h1,h2,h3,h4,h5,h6{margin-top:3.56rem;}</style><link href="//fonts.googleapis.com/css?family=Open+Sans:700|Merriweather:300,300i,700,700i" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/webpack-runtime-536a6c260e38217d70af.js"/><link as="script" rel="preload" href="/app-e8959f9b77d9af74bf43.js"/><link as="script" rel="preload" href="/0-877f5681d9ca5e2a6105.js"/><link as="script" rel="preload" href="/8-db80e36cf1deddcc80fc.js"/><link as="script" rel="preload" href="/1-c1ac19d4584be5e780ce.js"/><link as="script" rel="preload" href="/component---src-components-blog-post-js-5df367bc6e0e0bb7ac59.js"/><link as="fetch" rel="preload" href="/static/d/684/path---django-descriptors-0-eb-27b-sUYoIIiDQxmqbfYP8CLGPq986DA.json" crossOrigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><style data-emotion-css="1xguuf2">.css-1xguuf2{background-color:#ff6f69;background-image:linear-gradient( to right,#ffcc5c,#ff6f69 );box-shadow:0px 2px 2px 0px #ccc;}@media (min-width:768px){.css-1xguuf2{background-image:linear-gradient(to right,#0e9aa7,#96ceb4,#ffcc5c,#ff6f69,#ced07d);}}</style><header class="css-1xguuf2 e15etjgo0"><style data-emotion-css="iwbfz7">.css-iwbfz7{margin:0 auto;max-width:980px;padding-left:0.89rem;padding-right:0.89rem;padding-top:0.89rem;padding-bottom:0.89rem;}@media (min-width:768px){.css-iwbfz7{padding-left:1.78rem;padding-right:1.78rem;}}</style><div class="css-iwbfz7 e15etjgo2"><style data-emotion-css="18ck0o5">.css-18ck0o5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:no-wrap;-ms-flex-wrap:no-wrap;flex-wrap:no-wrap;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}</style><div class="css-18ck0o5 ec4z7qb1"><style data-emotion-css="41mxrj">.css-41mxrj{margin:0;max-width:calc(50% - 0.445rem);}</style><h3 class="css-41mxrj e15etjgo4"><style data-emotion-css="1w4zlaz">.css-1w4zlaz{color:white;}.css-1w4zlaz,.css-1w4zlaz:hover{-webkit-text-decoration:none;text-decoration:none;}</style><a class="css-1w4zlaz e15etjgo1" href="/">Kevin Stone</a></h3><div class="css-41mxrj e15etjgo3"><style data-emotion-css="1d0vcgf">.css-1d0vcgf{margin:0;position:relative;width:100%;}</style><form class="css-1d0vcgf e15vkf1q0"><style data-emotion-css="165ajue">.css-165ajue{margin:0;padding:0 0.8em;background-color:transparent;color:white;-webkit-transition:background-color 0.5s;transition:background-color 0.5s;border:1px solid #ffcc5c;border-radius:4px;width:100%;}.css-165ajue:focus,.css-165ajue:hover{outline:none;background-color:white;color:#ff6f69;}</style><input type="search" name="query" placeholder="Search" autoComplete="off" autoCorrect="off" autoCapitalize="off" spellcheck="false" value="" class="css-165ajue e1vo72mx0"/><style data-emotion-css="1ne8yiy">.css-1ne8yiy{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-wrap:no-wrap;-ms-flex-wrap:no-wrap;flex-wrap:no-wrap;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;list-style-type:none;margin:0;padding:0;position:absolute;width:100%;}</style><div class="css-1ne8yiy elewai50"></div></form></div></div></div></header><main><style data-emotion-css="13cixxm">.css-13cixxm{background-position:center;background-size:cover;color:white;margin-bottom:2.67rem;padding:3.56rem 0;text-align:center;box-shadow:0px 2px 2px 0px #ccc;background-image:url(/static/168ff2c80f69305a62d81ee656ccc4ab/47e27/gradient-patterns-simple-background-widescreen-798987-1920x1080.jpg),url(data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMCBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAACBP/aAAwDAQACEAMQAAABix9iWzIHiX//xAAZEAACAwEAAAAAAAAAAAAAAAAAAgEDETH/2gAIAQEAAQUCVNJrJUrGG7//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/AW5hD//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/Aar/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAADAAMAAAAAAAAAAAAAAAAAAREQITH/2gAIAQEAAT8hJoIM5EUw/wD/2gAMAwEAAgADAAAAEMQP/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEh/9oACAEDAQE/EKsJf//EABcRAQEBAQAAAAAAAAAAAAAAAAEAESH/2gAIAQIBAT8QU9h5f//EABkQAAMBAQEAAAAAAAAAAAAAAAABESFBMf/aAAgBAQABPxBnA9VCioIowQ88EVYf/9k=);}</style><div class="css-13cixxm eqkxgqz0"><style data-emotion-css="19pq5hu">.css-19pq5hu{margin:0 auto;max-width:980px;padding-left:0.89rem;padding-right:0.89rem;}@media (min-width:768px){.css-19pq5hu{padding-left:1.78rem;padding-right:1.78rem;}}</style><div class="css-19pq5hu e1mv9duo0"><h1>Django Model Descriptors</h1><style data-emotion-css="2552nd">.css-2552nd{margin-top:-0.89rem;}</style><p class="css-2552nd eywqi3t0">November 26, 2014</p></div></div><style data-emotion-css="19pq5hu">.css-19pq5hu{margin:0 auto;max-width:980px;padding-left:0.89rem;padding-right:0.89rem;}@media (min-width:768px){.css-19pq5hu{padding-left:1.78rem;padding-right:1.78rem;}}</style><div class="css-19pq5hu e1mv9duo0"><style data-emotion-css="17krvi4">.css-17krvi4 h1,.css-17krvi4 h2,.css-17krvi4 h3,.css-17krvi4 h4,.css-17krvi4 h5,.css-17krvi4 h6{color:#ff6f69;}</style><article class="css-17krvi4 ec32is30"><p>How can we enhance our Django model fields to act beyond simple database types
to encapsulate their associated business logic? Leveraging Python's
descriptor protocol, we provide additional processing on retrieval and update
to allow more re-usable fields.</p>
<h2 id="python-descriptors"><a href="#python-descriptors" aria-label="python descriptors permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Python Descriptors</h2>
<p>What are <a href="https://docs.python.org/2/howto/descriptor.html">Python Descriptors</a>? They're one of the least
understood aspects of the language, but I think of them like class-based
<a href="https://docs.python.org/2/library/functions.html#property">properties</a>. Just as you can provide a <code>__call__</code> method on a
class so that it acts like a function, you can supply a <code>__get__</code> (or
<code>__set__</code> or <code>__delete__</code>) and the class will similarly act more like a
property.</p>
<p>This allows us to capture common property definitions in a re-usable construct
that we can apply as generic functionality to our models. If you're read the
post on <a href="/django-model-behaviors">Django Model Behaviors</a>, you understand how
to package common field definitions into a shared model behavior that you can
combine to assemble your models from more atomic functionality. Leveraging
descriptors, you can perform a similar deconstruction but this time by
creating re-usable fields with enhanced logic without being tied to a given
model definition.</p>
<h4 id="sample-code"><a href="#sample-code" aria-label="sample code permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sample Code</h4>
<p>All the sample code for this project is available on a <a href="https://github.com/kevinastone/django-descriptors">GitHub
repository</a>. Feel free to use it as the basis for your own
experimentation.</p>
<h2 id="enhance-your-models-with-properties"><a href="#enhance-your-models-with-properties" aria-label="enhance your models with properties permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enhance your Models with Properties</h2>
<p>A common use of properties is to perform calculations or manipulations on a
given field and provide that as additional information.</p>
<p>For example, let's start with this Bookmark model that features a <code>url</code> field:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">Bookmark</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>It's very simple and straightforward. Now let's say we want to extract some
additional information about the stored url, say it's domain/hostname so we
can show a favicon on our listing. Since the url already contains the
hostname, we can add a method or a property to our model which retrieves the
url, and then parses out the hostname.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> urlparse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">Bookmark</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">hostname</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> urlparse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname</code></pre></div>
<p>Now, when we're accessing our bookmark model instances, we can simple refer to
<code>obj.hostname</code>. This pattern works great for many common derived or computed
values. No reason to store redundant information when we can calculate it on
the fly from other model attributes.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> boomark <span class="token operator">=</span> Bookmark<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://example.com/abcd'</span><span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># Let's access our hostname property</span>
<span class="token operator">>></span><span class="token operator">></span> bookmark<span class="token punctuation">.</span>hostname
'example<span class="token punctuation">.</span>com`</code></pre></div>
<p>But as we add more and more computed values, these properties tend to overload
our models, cluttering our codebase. Plus, we are frequently adding the same
properties again and again, repeating the same functionality for each field.
What we'd like is a way to associate a given property with the model field
that derives it.</p>
<h2 id="descriptors-as-reusable-properties"><a href="#descriptors-as-reusable-properties" aria-label="descriptors as reusable properties permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Descriptors as Reusable Properties</h2>
<p>Rather than define a bunch of properties, what we'd rather do is something
like: <code>obj.url.hostname</code>, and encapsulate all the derived logic on the url
field. Yet when you access a model instance's field, it's simply returned
just like the original python type (str/unicode in the case of a <em>URLField</em>).
These additional properties would be transparent to the rest of the code.</p>
<p>So, we need to intercept the value returned by accessing the field on the
instance and <strong>enhance</strong> it with our custom properties. This is where the
descriptor protocol comes into play. It gives us a chance to intercept and
substitute the value returned when an attribute is accessed on a given class
instance.</p>
<p>To make this work, we actually need two components. First, we need our
descriptor which performs the intercept and substitution. Second, we need a
proxy model that acts like the original datatype, but is augmented with the
additional custom properties.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">URLFieldProxy</span><span class="token punctuation">(</span><span class="token builtin">unicode</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">hostname</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> urlparse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">.</span>hostname


<span class="token keyword">class</span> <span class="token class-name">ProxyFieldDescriptor</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> field_name<span class="token punctuation">,</span> proxy_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>field_name <span class="token operator">=</span> field_name
        self<span class="token punctuation">.</span>proxy_class <span class="token operator">=</span> proxy_class

    <span class="token keyword">def</span> <span class="token function">__get__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> owner<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># grab the original value before we proxy</span>
        value <span class="token operator">=</span> instance<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>self<span class="token punctuation">.</span>field_name<span class="token punctuation">]</span>
        <span class="token keyword">if</span> value <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># We can't proxy a None through a unicode sub-class</span>
            <span class="token keyword">return</span> value
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>proxy_class<span class="token punctuation">(</span>value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__set__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>self<span class="token punctuation">.</span>field_name<span class="token punctuation">]</span> <span class="token operator">=</span> value</code></pre></div>
<p>Our <em>Proxy</em> class, <code>URLFieldProxy</code>, sub-classes the base type that the field
would return (<code>unicode</code> in this case). That ensures we have the same base
datatype. And then it adds a property for calculating the derived value(s).</p>
<p>Our <em>Descriptor</em> class, <code>ProxyFieldDescriptor</code>, is a regular python object,
with the magic methods <code>__get__</code> and <code>__set__</code> that define a descriptor. It
features a constructor that takes a two arguments, the name of the field we
want to intercept, and the proxy class we want to substitute. The <code>__get__</code>
implementation looks up the original value of the intercepted field using
<code>instance.__dict__</code> and then instantiates our proxy class passing in that
original value. We special case <code>None</code> since our proxy can't handle that type
directly (<em>None</em> values can't have properties). <code>__set__</code> simply stores the
value directly without modification.</p>
<p>Before we talk through how to attach this descriptor to your django model
field, let's put our implementation through some paces to show how a
descriptor operates.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SomeObject</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Let's add our descriptor on the `url` field substituting `URLFieldProxy`</span>
    wormhole <span class="token operator">=</span> ProxyFieldDescriptor<span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">,</span> URLFieldProxy<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url</code></pre></div>
<p>Remember that we defined our descriptor to look up it's real value from the
passed in argument name. It then returns the <em>Proxy</em> model that adds the
computed properties. Let's see it in action:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> obj <span class="token operator">=</span> SomeObject<span class="token punctuation">(</span><span class="token string">'http://example.com/asdf'</span><span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># Normal attribute access still works</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>url
<span class="token string">'http://example.com/asdf'</span>

<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># Does obj.url have a hostname property?</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>url<span class="token punctuation">.</span>hostname
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
AttributeError                            Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># What about accessing our descriptor field?</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>wormhole
u<span class="token string">'http://example.com/asdf'</span>

<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># Let's access the descriptor's property</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>wormhole<span class="token punctuation">.</span>hostname
u<span class="token string">'example.com'</span>

<span class="token comment"># As you can see, the descriptor returns our proxy</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">type</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>wormhole<span class="token punctuation">)</span>
__main__<span class="token punctuation">.</span>URLFieldProxy

<span class="token comment"># But the proxy still *acts* like our original url attribute</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>wormhole <span class="token operator">==</span> obj<span class="token punctuation">.</span>url
<span class="token boolean">True</span></code></pre></div>
<h3 id="customize-django-model-fields-with-descriptors"><a href="#customize-django-model-fields-with-descriptors" aria-label="customize django model fields with descriptors permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customize Django Model Fields with Descriptors</h3>
<p>Now, we need to customize the Django <code>URLField</code> to hook in to the descriptor
class. Thankfully, django provides an accessible mechanism under a method
named <code>contribute_to_class</code> that allows you to customize how a field class is
attached to its model instance. The specifics of how this method works are
convoluted and related to the metaclass magic that django model definitions
perform.</p>
<p>Since <code>contribute_to_class</code> is used by django when building the model
instance, we simply attach our descriptor in the place of the field's name on
our constructed model instance using <code>setattr()</code> with <code>self.name</code> representing
the name of the field ("url" in our case).</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">HostnamedURLField</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>URLField<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">contribute_to_class</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cls<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>HostnamedURLField<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>contribute_to_class<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token comment"># Add our descriptor to this field in place of of the normal attribute</span>
        <span class="token builtin">setattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> ProxyFieldDescriptor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> URLFieldProxy<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Finally, let's update our model to use our customized url field. Notice our
model definition knows nothing about hostnames, it's all encapsulated in our
customized <em>URLField</em>.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">Bookmark</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    url <span class="token operator">=</span> HostnamedURLField<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<p>With the model all wired up with our descriptor wielding field, let's
see if it works.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> bookmark <span class="token operator">=</span> Bookmark<span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'http://example.com/asdf'</span><span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span> bookmark<span class="token punctuation">.</span>url
u<span class="token string">'http://example.com/asdf'</span>

<span class="token operator">>></span><span class="token operator">></span> bookmark<span class="token punctuation">.</span>url<span class="token punctuation">.</span>hostname
u<span class="token string">'example.com'</span>

<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># You can assign to the descriptor field too</span>
<span class="token operator">>></span><span class="token operator">></span> bookmark<span class="token punctuation">.</span>url <span class="token operator">=</span> u<span class="token string">'http://somewhere.com/else'</span>

<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># And it still keeps all the same semantics</span>
<span class="token operator">>></span><span class="token operator">></span> bookmark<span class="token punctuation">.</span>url<span class="token punctuation">.</span>hostname
u<span class="token string">'somewhere.com'</span></code></pre></div>
<p>There you go, we have a successfully migrated a computed property from the
model definition to the field definition. This helps keep common
functionality encapsulated, allowing greater re-use and cleaner separation of
concerns.</p>
<h2 id="descriptors-for-alternative-representations"><a href="#descriptors-for-alternative-representations" aria-label="descriptors for alternative representations permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Descriptors for Alternative Representations</h2>
<p>Besides just augmenting fields with computed properties, descriptors can also
be used to provide additional representations for your model data.</p>
<p>One of my favorite database modeling patterns is to use timestamps for boolean
flags. If a timestamp is NULL, it's off (or disabled). When a timestamp is
set, the flag is enabled. This gives you both a status (on/off) as well as a
history of when the flag was enabled.</p>
<p>In most uses, we're only concerned with the status, so a boolean data type is
more representative. But certain views would like to know this date
information (for say a management overview).</p>
<p>Let's create another simple model to walk through such a use case:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">BlogPost</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    content <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    published_at <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span></code></pre></div>
<p>With a <code>published_at</code> field, we can show visitors posts that have been marked
ready for publication, as well as sort our blog posts based on their
publication date. This same pattern works great for any moderation task,
including comments, account setup, or content release.</p>
<p>With our model, we can create a few posts and then publish them by setting our
timestamp field to a non-NULL value.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>utils <span class="token keyword">import</span> timezone
<span class="token operator">>></span><span class="token operator">></span> post <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>published_at <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span>
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> BlogPost<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>published_at__isnull<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># Now let's set our published flag</span>
<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>published_at <span class="token operator">=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>published_at <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> BlogPost<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>published_at__isnull<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token operator">&lt;</span>BlogPost<span class="token punctuation">:</span> BlogPost <span class="token builtin">object</span><span class="token operator">></span><span class="token punctuation">]</span></code></pre></div>
<h3 id="creating-a-hybrid-booleantimestamp-descriptor"><a href="#creating-a-hybrid-booleantimestamp-descriptor" aria-label="creating a hybrid booleantimestamp descriptor permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a Hybrid Boolean/Timestamp Descriptor</h3>
<p>Using a datetime field gives us that extra information, but it makes working
with such fields less intuitive. You have to know it's a datetime value
rather than a boolean. What if we could use descriptors to modify the
returned field to act like a boolean?</p>
<p>Let's create a descriptor class that proxies our datetime value, but acts like
a boolean.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TimestampedBooleanDescriptor</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name

    <span class="token keyword">def</span> <span class="token function">__get__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> owner<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>self<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__set__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        value <span class="token operator">=</span> <span class="token builtin">bool</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> value <span class="token operator">!=</span> self<span class="token punctuation">.</span>__get__<span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> value<span class="token punctuation">:</span>
                instance<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>self<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                instance<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>self<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span></code></pre></div>
<p>It handles two cases, the first is on <code>__get__</code> where it checks its stored
timestamp against None. The other case is when <code>__set__</code> is called, it checks
the input value (a boolean) and if it's changed, either sets or clears the
internal datetime representation.</p>
<p>Let's build an example to use this descriptor.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">SomeObject</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Let's add our descriptor on the `timestamp` field</span>
    boolean <span class="token operator">=</span> TimestampedBooleanDescriptor<span class="token punctuation">(</span><span class="token string">'timestamp'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> timestamp<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> timestamp</code></pre></div>
<p>And let's put our sample object through some paces:</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> obj <span class="token operator">=</span> SomeObject<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>timestamp <span class="token keyword">is</span> <span class="token boolean">None</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>boolean
<span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>timestamp <span class="token operator">=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>boolean
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>boolean <span class="token operator">=</span> <span class="token boolean">False</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>timestamp <span class="token keyword">is</span> <span class="token boolean">None</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>boolean <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> obj<span class="token punctuation">.</span>timestamp
datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">872457</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span><span class="token operator">&lt;</span>UTC<span class="token operator">></span><span class="token punctuation">)</span></code></pre></div>
<p>Through the descriptor protocol, we were able to extend the functionality of
our fields to both support a datetime and a boolean interface.</p>
<p>Now, let's extend the built-in <code>DateTimeField</code> to use our descriptor class to
provide both interfaces. Our field adds two capabilities: first, we want to
add a second property on the given model for the boolean access (it defaults
to <code>is_&#x3C;field_name></code>). Second, we again use <code>contribute_to_class</code> to add our
additional boolean property on the model class.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">TimestampedBooleanField</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    A Boolean field that also captures the timestamp when the value was set.

    This field stores a timestamp in the database when set.  It can be accessed
    as a boolean using the property argument (when not provided, it defaults to
    is_{field_name}).
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>property_name <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'property'</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        kwargs<span class="token punctuation">[</span><span class="token string">'null'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TimestampedBooleanField<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">contribute_to_class</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> cls<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>TimestampedBooleanField<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>contribute_to_class<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> name<span class="token punctuation">)</span>
        <span class="token comment"># Use the defined boolean property name or pick a default</span>
        property_name <span class="token operator">=</span> self<span class="token punctuation">.</span>property_name <span class="token operator">or</span> <span class="token string">'is_{0}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token builtin">setattr</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> property_name<span class="token punctuation">,</span> TimestampedBooleanDescriptor<span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>Let's now update our <code>BlogPost</code> model to use this timestamp field.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">BlogPost</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    content <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    published_at <span class="token operator">=</span> TimestampedBooleanField<span class="token punctuation">(</span><span class="token builtin">property</span><span class="token operator">=</span><span class="token string">'is_published'</span><span class="token punctuation">)</span></code></pre></div>
<p>With the model all wired up with our descriptor wielding field, let's
see if it works.</p>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> post <span class="token operator">=</span> BlogPost<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>published_at <span class="token keyword">is</span> <span class="token boolean">None</span>
<span class="token boolean">True</span>

<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>is_published
<span class="token boolean">False</span>

<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>is_published <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>published_at
datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">191879</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span><span class="token operator">&lt;</span>UTC<span class="token operator">></span><span class="token punctuation">)</span>

<span class="token comment"># Still works after reloading from the DB</span>
<span class="token operator">>></span><span class="token operator">></span> post<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> post2 <span class="token operator">=</span> BlogPost<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>post<span class="token punctuation">.</span>pk<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> post2<span class="token punctuation">.</span>is_published
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> post2<span class="token punctuation">.</span>published_at
datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2014</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">47</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">191879</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span><span class="token operator">&lt;</span>UTC<span class="token operator">></span><span class="token punctuation">)</span></code></pre></div>
<p>There you go, depending on how you want to access your model, you can choose
to use either the timestamp attribute or the boolean. All of this is
encapsulated in a descriptor class, keeping your model definition clean and
intuitive.</p>
<h2 id="summary"><a href="#summary" aria-label="summary permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h2>
<p>There's numerous opportunities to leverage descriptors to enhance your model
fields. Django itself uses them to handle File Upload fields since they're
stored in the database as pathnames to the file, but provided as a file-like
proxies to your django code.</p>
<p>There's plenty of additional uses for descriptors. Please leave a comment (or
tweet, etc) if you have addditional ideas or examples where descriptors can
improve your model code.</p></article><div id="disqus_thread"></div></div></main><style data-emotion-css="1tpqomq">.css-1tpqomq{margin:0 auto;max-width:980px;padding-left:0.89rem;padding-right:0.89rem;text-align:center;padding:1.78rem;}@media (min-width:768px){.css-1tpqomq{padding-left:1.78rem;padding-right:1.78rem;}}</style><footer class="css-1tpqomq e1wsq9gq1">© <!-- -->Kevin Stone<!-- --> <!-- -->2019<!-- -->, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-44610401-1', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-components-blog-post-js","jsonName":"django-descriptors-0eb","path":"/django-descriptors"};window.dataPath="684/path---django-descriptors-0-eb-27b-sUYoIIiDQxmqbfYP8CLGPq986DA";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app.b6f197430f783b3e67aa.css","/app-e8959f9b77d9af74bf43.js"],"component---src-components-blog-post-js":["/component---src-components-blog-post-js-5df367bc6e0e0bb7ac59.js"],"component---src-pages-404-js":["/component---src-pages-404-js-d2c7d9e93115feb947b8.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d56132c1c20fe7659708.js"],"pages-manifest":["/pages-manifest-d9723a857f4a3d79f878.js"]};/*]]>*/</script><script src="/component---src-components-blog-post-js-5df367bc6e0e0bb7ac59.js" async=""></script><script src="/1-c1ac19d4584be5e780ce.js" async=""></script><script src="/8-db80e36cf1deddcc80fc.js" async=""></script><script src="/0-877f5681d9ca5e2a6105.js" async=""></script><script src="/app-e8959f9b77d9af74bf43.js" async=""></script><script src="/webpack-runtime-536a6c260e38217d70af.js" async=""></script></body></html>