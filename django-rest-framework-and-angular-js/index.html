<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.16.8"><link rel="alternate" type="application/rss+xml" title="Kevin Stone" href="/rss.xml"><title>Getting Started with Django Rest Framework and AngularJS</title><link rel="canonical" href="https://blog.kevinastone.com/django-rest-framework-and-angular-js/"><meta name="description" content="Personal blog for Kevin Stone."><meta name="robots" content="index, follow"><meta property="og:title" content="Getting Started with Django Rest Framework and AngularJS"><meta property="og:type" content="article"><meta property="og:image" content><meta property="og:url" content="https://blog.kevinastone.com/django-rest-framework-and-angular-js/"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@kevinastone"><meta name="keywords"><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/assets/ClientRouter.astro_astro_type_script_index_0_lang.CDGfc0hd.js"></script><style>code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.property,.token.tag,.token.constant,.token.symbol,.token.deleted{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#a6e22e}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function,.token.class-name{color:#e6db74}.token.keyword{color:#66d9ef}.token.regex,.token.important{color:#fd971f}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.img-wrapper[data-astro-cid-3eui6wlw]{background-color:var(--base);display:flex;position:absolute;overflow:hidden;width:100%;height:100%}.img-wrapper[data-astro-cid-3eui6wlw] .duotone-img{filter:grayscale(100%) contrast(1);mix-blend-mode:multiply;opacity:var(--opacity);object-fit:cover;width:100%;height:100%;display:block}.img-wrapper[data-astro-cid-3eui6wlw]:before{content:"";position:absolute;inset:0;background-color:var(--foreground);mix-blend-mode:overlay;z-index:1;pointer-events:none}/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-font-weight:initial}}}.wrapper[data-astro-cid-vva3ln22]{justify-content:center;align-items:center;width:100%;display:flex;position:relative}.hero[data-astro-cid-vva3ln22]{color:#fff;margin-bottom:var(--spacing-rhythm-1\.5,calc(1.5*var(--spacing-rhythm)));padding-block:var(--spacing-rhythm-2,calc(2*var(--spacing-rhythm)));text-align:center}.hero[data-astro-cid-vva3ln22] h1{margin-top:var(--spacing-rhythm-2,calc(2*var(--spacing-rhythm)));margin-bottom:calc(var(--spacing,.25rem)*8);font-size:var(--text-4xl,2.25rem);line-height:var(--tw-leading,var(--text-4xl--line-height,calc(2.5/2.25)));--tw-font-weight:var(--font-weight-bold,700);font-weight:var(--font-weight-bold,700)}.bg[data-astro-cid-vva3ln22]{z-index:1;object-fit:cover;object-position:center;width:100%;height:100%;position:absolute;inset:0}.content[data-astro-cid-vva3ln22]{z-index:3;position:relative}@property --tw-font-weight{syntax:"*";inherits:false}
</style>
<link rel="stylesheet" href="/assets/_id_.CcwR0QAT.css"></head> <body> <header class="brand-bg-gradient" data-astro-cid-3ef6ksr2> <div class="navbar" data-astro-cid-3ef6ksr2> <div class="fixed-width">  <div class="row" data-astro-cid-3ef6ksr2> <div class="brand" data-astro-cid-3ef6ksr2> <a href="/" data-astro-cid-3ef6ksr2>Kevin Stone</a> </div> <div class="search" data-astro-cid-3ef6ksr2> <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();</script><script>(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Z2nfyNG" prefix="r2" component-url="/assets/app.CJIVqAcf.js" component-export="default" renderer-url="/assets/client.Bfkaqq2T.js" props="{&quot;data-astro-cid-3ef6ksr2&quot;:[0,true]}" ssr client="load" opts="{&quot;name&quot;:&quot;Search&quot;,&quot;value&quot;:true}" await-children><form class="relative w-full m-0"><input class="
        w-full
        bg-transparent
        border
        border-accent
        rounded-sm
        text-background
        m-0
        outline-none
        py-1
        px-3
        transition-colors
        duration-500
        focus:bg-background
        focus:border-transparent
        focus:text-primary
        hover:bg-background
        hover:border-transparent
        hover:text-primary
        not-placeholder-shown:bg-background
        not-placeholder-shown:text-primary
      " type="search" placeholder="Search" autoComplete="off" autoCorrect="off" autoCapitalize="off" spellCheck="false" name="query" value=""/><ul class="absolute w-full mt-1 overflow-hidden list-none p-0 bg-background rounded-md shadow-lg z-50"></ul></form><!--astro:end--></astro-island> </div> </div>  </div> </div> </header>  <div class="wrapper hero brand-bg-gradient" data-astro-cid-vva3ln22>  <div class="content" data-astro-cid-vva3ln22>  <div class="fixed-width">  <h1>Getting Started with Django Rest Framework and AngularJS</h1> <p class="sub-heading"> <time datetime="2013-10-02T00:00:00.000Z"> October 02, 2013 </time> </p>  </div>  </div> </div>  <main> <div class="fixed-width">    <article class="prose max-w-none"> <p>A <a href="http://en.wikipedia.org/wiki/Representational_state_transfer" title="Representational State Transfer">ReSTful API</a> is becoming a standard component of any modern web application. The <a href="http://django-rest-framework.org" title="Django Rest Framework">Django Rest Framework</a> is powerful framework for developing ReST endpoints for your Django based project. <a href="http://angularjs.org" title="Angular JS">AngularJS</a> is modern javascript framework for creating complex web applications within the browser. It focuses on strong separation of concerns (MVC) and dependency injection to encourage creating maintainable (and testable) modules that can be integrated to develop rich client side functionality.</p>
<p>In this blog post, I’ll walk through creating a sample project that exposes a ReST API consumed by AngularJS on the client to showcase how to combine the frontend and backend frameworks to simplify creating complex applications. I’ll make heavy use of code examples to demonstrate both the solution and the process and there’s a companion <a href="https://github.com/kevinastone/django-api-rest-and-angular">Github project</a> with all the code.</p>
<h2 id="lets-build-a-sample-django-project">Let’s Build a Sample Django Project</h2>
<p>For a sample project, let’s create a simple photo-sharing app (not unlike a rudimentary Instagram) and build a feed view for a given user to scan through all the photos shared on the site.</p>
<p>All the sample code for this project is available on a <a href="https://github.com/kevinastone/django-api-rest-and-angular">GitHub repository</a>. To setup the sample project in your own environment, consult the <a href="https://github.com/kevinastone/django-api-rest-and-angular/blob/master/Readme.markdown">installation instructions</a> included in the repository. This includes installing AngularJS (and other javascript assets) via <a href="http://yeoman.io">bower+grunt</a>.</p>
<p>Finally, there’s some sample data in fixtures available to demonstrate the API. We have a few users (<code>['Bob', 'Sally', 'Joe', 'Rachel']</code>), two posts (<code>['This is a great post', 'Another thing I wanted to share']</code>) and some sample photos as well. The included Makefile builds the sample data for you.</p>
<p>Couple notes about the sample code:</p>
<ul>
<li>I’ll skip over the details on configuring, building and running the sample application. There’s <a href="https://github.com/kevinastone/django-api-rest-and-angular/blob/master/Readme.markdown">instructions</a> in the <a href="https://github.com/kevinastone/django-api-rest-and-angular">repository</a> that covers many of these details. Please report any issues on GitHub and I’ll be sure to fix them.</li>
<li>I’ve written the frontend code using <a href="http://coffeescript.org">Coffee-Script</a> since I find it more legible and more efficient (and a bit more Pythonic). There’s a supplied Grunt task that collects all the coffee script files and concats them into a single <code>script.js</code> file for inclusion.</li>
</ul>
<h3 id="project-data-layer-the-models">Project Data Layer (the Models)</h3>
<p>Our model layer is straightforward to what you might find in an introductory tutorial for Django. You have three models of note: <code>User</code>, <code>Post</code>, and <code>Photo</code>. A user can author many posts (as well as have many followers) and a post can showcase many photos (such as a collection or gallery) along with a title and optional description/body.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> AbstractUser


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>AbstractUser<span class="token punctuation">)</span><span class="token punctuation">:</span>
    followers <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span><span class="token string">'self'</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'followees'</span><span class="token punctuation">,</span> symmetrical<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    author <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>User<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'posts'</span><span class="token punctuation">)</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">)</span>
    body <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span>blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Photo</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    post <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Post<span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'photos'</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> models<span class="token punctuation">.</span>ImageField<span class="token punctuation">(</span>upload_to<span class="token operator">=</span><span class="token string">"%Y/%m/%d"</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="django-rest-framework-based-api">Django Rest Framework based API</h3>
<p>The <a href="http://django-rest-framework.org" title="Django Rest Framework">Django Rest Framework (DRF)</a> provides a clean architecture to develop both simple, turn-key API endpoints as well as more complex ReST constructs. The key is a clean separation with <code>Serializer</code> which describes the mapping between a model and the generalized wire representation (be it JSON, XML or whatever) and separate set of generic Class-Based-Views that can be extended to meet the needs of the specific API endpoint. You also define your own URL structure rather than rely on an auto-generated one. This is what separates DRF from other frameworks like <a href="http://tastypieapi.org">Tastypie</a> and <a href="https://bitbucket.org/jespern/django-piston/wiki/Home">Piston</a> that automate much of the conversion from django models to ReST endpoints, but come at the cost of flexibility in adapting to different use cases (especially around permissions and nested resources).</p>
<h3 id="model-serializers">Model Serializers</h3>
<p>The <code>Serializers</code> in DRF focus on the responsibility to convert django model instances into their representation in the API. This gives us the opportunity to convert any data types, or provide supplemental information in a given model. For example, for the user, we only included some of the fields, stripping private attributes such as <code>password</code> and <code>email</code>. For the photo, we converted the <code>ImageField</code> to return the url of the image (rather than the media path location).</p>
<p>For the <code>PostSerializer</code>, we elected to embed the author directly in the Post (rather the the common case to provide a hyperlink). This makes that information readily accessible to our client rather than requiring extra API requests at the cost of duplicating users on each post. The alternative hyperlink is listed with a comment for comparison. The power of serializers is that you can extend them to create a derivative version, that uses hyperlinks instead of nested records (say, for the case of listing posts by a specific users’ feed).</p>
<p>To assign the <code>author</code> to the <code>PostSerializer</code>, we’re gonna have that provided by the API View. So we’ll make it optional (<code>required=False</code>) in our serializer and add it to the validation exclusion.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> User<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Photo


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    posts <span class="token operator">=</span> serializers<span class="token punctuation">.</span>HyperlinkedIdentityField<span class="token punctuation">(</span><span class="token string">'posts'</span><span class="token punctuation">,</span> view_name<span class="token operator">=</span><span class="token string">'userpost-list'</span><span class="token punctuation">,</span> lookup_field<span class="token operator">=</span><span class="token string">'username'</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'first_name'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">,</span> <span class="token string">'posts'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PostSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    author <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    photos <span class="token operator">=</span> serializers<span class="token punctuation">.</span>HyperlinkedIdentityField<span class="token punctuation">(</span><span class="token string">'photos'</span><span class="token punctuation">,</span> view_name<span class="token operator">=</span><span class="token string">'postphoto-list'</span><span class="token punctuation">)</span>
    <span class="token comment"># author = serializers.HyperlinkedRelatedField(view_name='user-detail', lookup_field='username')</span>

    <span class="token keyword">def</span> <span class="token function">get_validation_exclusions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Need to exclude `author` since we'll add that later based off the request</span>
        exclusions <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>PostSerializer<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>get_validation_exclusions<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> exclusions <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token string">'author'</span><span class="token punctuation">]</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Post


<span class="token keyword">class</span> <span class="token class-name">PhotoSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    image <span class="token operator">=</span> serializers<span class="token punctuation">.</span>Field<span class="token punctuation">(</span><span class="token string">'image.url'</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Photo

</code></pre>
<p>Okay, given our samples are fixtures are loaded, let’s play with these serializers. You’ll likely see <code>DeprecationWarning</code> because we’re using <code>HyperlinkedIdentityField</code> without providing a request object to construct the URL. In the actual views, this is provided, so you can safely ignore.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> example<span class="token punctuation">.</span>api<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token operator">>></span><span class="token operator">></span> user <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'bob'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token comment"># Need to generate a fake request for our hyperlinked results</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>test<span class="token punctuation">.</span>client <span class="token keyword">import</span> RequestFactory
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> example<span class="token punctuation">.</span>api<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token operator">>></span><span class="token operator">></span> context <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>request<span class="token operator">=</span>RequestFactory<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> serializer <span class="token operator">=</span> UserSerializer<span class="token punctuation">(</span>user<span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> serializer<span class="token punctuation">.</span>data
<span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">u'bob'</span><span class="token punctuation">,</span> <span class="token string">'first_name'</span><span class="token punctuation">:</span> <span class="token string">u'Bob'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">u''</span><span class="token punctuation">,</span> <span class="token string">'posts'</span><span class="token punctuation">:</span> <span class="token string">'http://testserver/api/users/bob/posts'</span><span class="token punctuation">}</span>
<span class="token operator">>></span><span class="token operator">></span> post <span class="token operator">=</span> user<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> PostSerializer<span class="token punctuation">(</span>post<span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>data
<span class="token punctuation">{</span><span class="token string">'author'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">u'bob'</span><span class="token punctuation">,</span> <span class="token string">'first_name'</span><span class="token punctuation">:</span> <span class="token string">u'Bob'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">u''</span><span class="token punctuation">,</span> <span class="token string">'posts'</span><span class="token punctuation">:</span> <span class="token string">'http://testserver/api/users/bob/posts'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'photos'</span><span class="token punctuation">:</span> <span class="token string">'http://testserver/api/posts/2/photos'</span><span class="token punctuation">,</span> <span class="token string">u'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">u'Title #2'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">u'Another thing I wanted to share'</span><span class="token punctuation">}</span>
<span class="token operator">>></span><span class="token operator">></span> serializer <span class="token operator">=</span> PostSerializer<span class="token punctuation">(</span>user<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> context<span class="token operator">=</span>context<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> serializer<span class="token punctuation">.</span>data
<span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'author'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">u'bob'</span><span class="token punctuation">,</span> <span class="token string">'first_name'</span><span class="token punctuation">:</span> <span class="token string">u'Bob'</span><span class="token punctuation">,</span> <span class="token string">'last_name'</span><span class="token punctuation">:</span> <span class="token string">u''</span><span class="token punctuation">,</span> <span class="token string">'posts'</span><span class="token punctuation">:</span> <span class="token string">'http://testserver/api/users/bob/posts'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'photos'</span><span class="token punctuation">:</span> <span class="token string">'http://testserver/api/posts/2/photos'</span><span class="token punctuation">,</span> <span class="token string">u'id'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">u'Title #2'</span><span class="token punctuation">,</span> <span class="token string">'body'</span><span class="token punctuation">:</span> <span class="token string">u'Another thing I wanted to share'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre>
<h3 id="api-url-structure">API URL Structure</h3>
<p>For our API structure, we want to maintain a relatively flat structure to try to define canonical endpoints for given resources, but also provide some convenient nested listings for common filterings (such as posts for a given user and photos in a given post). Note that we use model primary keys as the identifier, but for users, we use their username since that’s also unique identifying (we’ll see this later in the views).</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> patterns<span class="token punctuation">,</span> url<span class="token punctuation">,</span> include

<span class="token keyword">from</span> <span class="token punctuation">.</span>api <span class="token keyword">import</span> UserList<span class="token punctuation">,</span> UserDetail
<span class="token keyword">from</span> <span class="token punctuation">.</span>api <span class="token keyword">import</span> PostList<span class="token punctuation">,</span> PostDetail<span class="token punctuation">,</span> UserPostList
<span class="token keyword">from</span> <span class="token punctuation">.</span>api <span class="token keyword">import</span> PhotoList<span class="token punctuation">,</span> PhotoDetail<span class="token punctuation">,</span> PostPhotoList

user_urls <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^/(?P&#x3C;username>[0-9a-zA-Z_-]+)/posts$'</span><span class="token punctuation">,</span> UserPostList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'userpost-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^/(?P&#x3C;username>[0-9a-zA-Z_-]+)$'</span><span class="token punctuation">,</span> UserDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'user-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^$'</span><span class="token punctuation">,</span> UserList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'user-list'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

post_urls <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^/(?P&#x3C;pk>\d+)/photos$'</span><span class="token punctuation">,</span> PostPhotoList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'postphoto-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^/(?P&#x3C;pk>\d+)$'</span><span class="token punctuation">,</span> PostDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'post-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^$'</span><span class="token punctuation">,</span> PostList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'post-list'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

photo_urls <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^/(?P&#x3C;pk>\d+)$'</span><span class="token punctuation">,</span> PhotoDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'photo-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^$'</span><span class="token punctuation">,</span> PhotoList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'photo-list'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

urlpatterns <span class="token operator">=</span> patterns<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^users'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>user_urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^posts'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>post_urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    url<span class="token punctuation">(</span><span class="token string">r'^photos'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>photo_urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre>
<h3 id="api-views">API Views</h3>
<p>Much of the power of Django Rest Framework is that the generic views make it easy to work with the common <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> cases with little or no modifications. For the simplest views, you provide a <code>model</code> and a <code>serializer_class</code> and extend one of the built in generics (like <code>ListAPIView</code> or <code>RetrieveAPIView</code>).</p>
<p>For our use case, we have a couple customizations. First, for users, we wanted to use <code>username</code> as the lookup field rather than <code>pk</code>. So we set <code>lookup_field</code> on the view (by default it’s both the <code>url_kwarg</code> and the field name on the model).</p>
<p>We also wanted to create nested versions of the views for a given user’s posts or the photos within a post. You simply override <code>get_queryset</code> on the view to customize the queryset to filter down the results based on the nested parameters (<code>username</code> and <code>pk</code> respectively).</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> generics<span class="token punctuation">,</span> permissions


<span class="token keyword">from</span> <span class="token punctuation">.</span>serializers <span class="token keyword">import</span> UserSerializer<span class="token punctuation">,</span> PostSerializer<span class="token punctuation">,</span> PhotoSerializer
<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> User<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> Photo


<span class="token keyword">class</span> <span class="token class-name">UserList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> User
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>
        permissions<span class="token punctuation">.</span>AllowAny
    <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">UserDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> User
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
    lookup_field <span class="token operator">=</span> <span class="token string">'username'</span>


<span class="token keyword">class</span> <span class="token class-name">PostList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Post
    queryset <span class="token operator">=</span> Post<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> PostSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>
        permissions<span class="token punctuation">.</span>AllowAny
    <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">PostDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Post
    queryset <span class="token operator">=</span> Post<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> PostSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>
        permissions<span class="token punctuation">.</span>AllowAny
    <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">UserPostList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Post
    queryset <span class="token operator">=</span> Post<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> PostSerializer

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        queryset <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>UserPostList<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> queryset<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>author__username<span class="token operator">=</span>self<span class="token punctuation">.</span>kwargs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PhotoList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Photo
    queryset <span class="token operator">=</span> Photo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> PhotoSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>
        permissions<span class="token punctuation">.</span>AllowAny
    <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">PhotoDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Photo
    queryset <span class="token operator">=</span> Photo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> PhotoSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>
        permissions<span class="token punctuation">.</span>AllowAny
    <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">PostPhotoList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Photo
    queryset <span class="token operator">=</span> Photo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> PhotoSerializer

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        queryset <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span>PostPhotoList<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>get_queryset<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> queryset<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>post__pk<span class="token operator">=</span>self<span class="token punctuation">.</span>kwargs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'pk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="interlude-built-in-api-browser">Interlude: Built-in API Browser</h3>
<p>One of the benefits of Django Rest Framework, is that it comes with a built-in API browser for testing out your API. Much like Django’s admin, this can help with initial development.</p>
<p>Simple load one of your API endpoints in the browser, and through content-negotiation, DRF will present to you a handy client interface to interact with your API.</p>
<p><img alt="API Browser Example for Users" loading="lazy" decoding="async" fetchpriority="auto" width="800" height="600" src="/assets/browser_users.4KBo17kz_Z1h7EbB.webp" >
<img alt="API Browser Example for User Posts" loading="lazy" decoding="async" fetchpriority="auto" width="800" height="600" src="/assets/browser_user_posts.81wgFaHv_2sYXTj.webp" ></p>
<h3 id="add-permissions-and-ownership-to-api">Add Permissions and Ownership to API</h3>
<p>As previously written, our API Views allow anyone to create anything on our site. Some of the advantages of using Django Rest Framework, is that the generic views make it easy to control permissions in the view without impact the underlying model and serializers. To incorporate some control over who is allowed to edit our API resources, we can created some permission classes that provide the authorization controls to restrict. They should return a boolean for the given request. This gives us access to the full request including cookies, the authenticated user and more.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions


<span class="token keyword">class</span> <span class="token class-name">SafeMethodsOnlyPermission</span><span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Only can access non-destructive methods (like GET and HEAD)"""</span>
    <span class="token keyword">def</span> <span class="token function">has_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>has_object_permission<span class="token punctuation">(</span>request<span class="token punctuation">,</span> view<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> request<span class="token punctuation">.</span>method <span class="token keyword">in</span> permissions<span class="token punctuation">.</span>SAFE_METHODS


<span class="token keyword">class</span> <span class="token class-name">PostAuthorCanEditPermission</span><span class="token punctuation">(</span>SafeMethodsOnlyPermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Allow everyone to list or view, but only the other can modify existing instances"""</span>
    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> obj <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># Either a list or a create, so no author</span>
            can_edit <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            can_edit <span class="token operator">=</span> request<span class="token punctuation">.</span>user <span class="token operator">==</span> obj<span class="token punctuation">.</span>author
        <span class="token keyword">return</span> can_edit <span class="token keyword">or</span> <span class="token builtin">super</span><span class="token punctuation">(</span>PostAuthorCanEditPermission<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>has_object_permission<span class="token punctuation">(</span>request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>
</code></pre>
<p>Besides simple authorization decisions, we also want to pre-fill values on save depending on who makes the requests. When someone creates a new <code>Post</code>, we want to assign them as the author. Because of the duplication between <code>PostList</code> and <code>PostDetail</code>, we can create a mixin class that holds all the common configuration (you can also use [ViewSets][viewsets] to accomplish similar consolidation).</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">class</span> <span class="token class-name">PostMixin</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Post
    queryset <span class="token operator">=</span> Post<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> PostSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>
        PostAuthorCanEditPermission
    <span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Force author to the current user on save"""</span>
        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>author<span class="token operator">=</span>self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">PostList</span><span class="token punctuation">(</span>PostMixin<span class="token punctuation">,</span> generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>


<span class="token keyword">class</span> <span class="token class-name">PostDetail</span><span class="token punctuation">(</span>PostMixin<span class="token punctuation">,</span> generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre>
<h2 id="consume-the-api-using-angularjs">Consume the API using AngularJS</h2>
<p>With the advent of more interactive web applications, a ReSTful API can be leveraged by rich client interfaces to expose and interact with your application’s data model. AngularJS is a great companion because of its clean separation of controls. AngularJS’s modular architecture involves a little bit of setup. Your app is composed of modules which define services, directives and controllers that compartmentalize the functionality for cleaner separation.</p>
<p>Part of the power of AngularJS, is that it provides <a href="http://en.wikipedia.org/wiki/Reactive_programming">reactive programming</a> leveraging their javascript-like expression language. We can simply define a template that references variables, and our page will automatically refresh when changes are made to those variables.</p>
<p>For the <em>hello world</em> style intro, we’ll simply list the posts in our sample application. Here is a bare bones template in AngularJS. First, at the top level on the body tag, we specify which angular app we are using to run this page (<code>example.app.basic</code>), which is where we’ll define the root module. Second, we need to specific the controller to manage our section (<code>AppController</code>). The controller in AngularJS parlance is really more like the model+controller in the traditional MVC (with the injected <code>$scope</code> containing the model state). Controllers define scopes that hold the actual model instances and they can be nested to narrow the scope of your system as your go down the DOM. Finally, we leverage an Angular directive (<code>ng-repeat</code>) which is a control structure to iterate over our <code>posts</code> model stored in the <code>$state</code>. Within that iteration, we define a few tags and use the angular expression syntax (kinda like django template tags) to print out the username of the author, and the title and body of the post.</p>
<p>*Note: Use verbatim tags to encapsulate the AngularJS expressions so that django doesn’t attempt to render them.</p>
<p>*Note: I’ve enclosed some sections in Django <code>{% block %}</code> tags so I can extend this template for each example.</p>
<pre class="language-django" data-language="django"><code is:raw="" class="language-django"><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">load</span> <span class="token variable">staticfiles</span> <span class="token delimiter punctuation">%}</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">static</span> <span class="token string">"bootstrap/dist/css/bootstrap.css"</span> <span class="token delimiter punctuation">%}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>body</span> <span class="token attr-name">ng-app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">ng_app</span> <span class="token delimiter punctuation">%}</span></span>example.app.static<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span> <span class="token attr-name">ng-controller</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">ng_controller</span> <span class="token delimiter punctuation">%}</span></span>AppController<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">content</span> <span class="token delimiter punctuation">%}</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">verbatim</span> <span class="token delimiter punctuation">%}</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>panel<span class="token punctuation">"</span></span> <span class="token attr-name">ng-repeat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post in posts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>panel-heading clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>panel-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">post</span><span class="token punctuation">.</span><span class="token variable">title</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h3</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>author</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pull-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">post</span><span class="token punctuation">.</span><span class="token variable">author</span><span class="token punctuation">.</span><span class="token variable">username</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>author</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>well<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">post</span><span class="token punctuation">.</span><span class="token variable">body</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endverbatim</span> <span class="token delimiter punctuation">%}</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">static</span> <span class="token string">"underscore/underscore.js"</span> <span class="token delimiter punctuation">%}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">static</span> <span class="token string">"angular/angular.js"</span> <span class="token delimiter punctuation">%}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">static</span> <span class="token string">"angular-resource/angular-resource.js"</span> <span class="token delimiter punctuation">%}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">static</span> <span class="token string">"js/script.js"</span> <span class="token delimiter punctuation">%}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
<p>Now, let’s pair this template with a simple controller that will supply the list of posts. We’ll hard-code the posts for now and then pull them in with Ajax in the next step.</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.app.static'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>controller <span class="token string">'AppController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span> <span class="token string">'$http'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> $http<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $scope<span class="token punctuation">.</span>posts <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token property">author</span><span class="token operator">:</span>
            <span class="token property">username</span><span class="token operator">:</span> <span class="token string">'Joe'</span>
        <span class="token property">title</span><span class="token operator">:</span> <span class="token string">'Sample Post #1'</span>
        <span class="token property">body</span><span class="token operator">:</span> <span class="token string">'This is the first sample post'</span>
    <span class="token punctuation">,</span>
        <span class="token property">author</span><span class="token operator">:</span>
            <span class="token property">username</span><span class="token operator">:</span> <span class="token string">'Karen'</span>
        <span class="token property">title</span><span class="token operator">:</span> <span class="token string">'Sample Post #2'</span>
        <span class="token property">body</span><span class="token operator">:</span> <span class="token string">'This is another sample post'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">]</span>
</code></pre>
<p>If you’ve got everything setup and run grunt to compile this down to javascript, you should see our <a href="http://localhost:8000/static">hard-coded template</a> rendered as such:</p>
<p><img alt="Basic Post List - Hard Coded" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="266" src="/assets/example_static.ClLOrqIb_ZUFYja.webp" ></p>
<h4 id="using-xhr-to-pull-posts-from-the-api">Using XHR to Pull Posts from the API</h4>
<p>Now, let’s go ahead and update or controller to instead grab the list of posts from our API endpoint. The <code>$http</code> service for AngularJS is similar to jQuery’s <code>$.ajax</code> or other XHR implementations. Notice, with AngularJS, we simply updated our model (<code>$scope.posts</code>) with the result of the ajax call, and our view is automatically updated in sync. No need to manipulate the DOM. This reactive style allows us to develop complex UIs with interdependencies between our data model and have the UI components respond appropriately without directly managing those connections, keeping our views and model layers loosely-coupled.</p>
<p>*Note the use of the promise chaining (<code>.then()</code>) on the <code>$http</code> call. You could just as easily pass a callback. You can take advantage of promise chaining to develop more complex API workflows such as creating a new post and then saving 3 photos.</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.app.basic'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>controller <span class="token string">'AppController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span> <span class="token string">'$http'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> $http<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $scope<span class="token punctuation">.</span>posts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    $http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/posts'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
        angular<span class="token punctuation">.</span>forEach result<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
            $scope<span class="token punctuation">.</span>posts<span class="token punctuation">.</span>push item
<span class="token punctuation">]</span>
</code></pre>
<p>With <code>$http</code> pulling the list of posts from our API, our <a href="http://localhost:8000/basic">example page</a> now shows a feed of posts from the server.</p>
<p><img alt="Basic Post List - XHR" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="262" src="/assets/example_basic.DpqGlXFy_1CwwDd.webp" ></p>
<h3 id="leveraging-angular-resource-for-api">Leveraging Angular-Resource for API</h3>
<p>While <code>$http</code> allows us to make the XHR calls to pull the API data into our app, it’s forcing us to hard code many details about our API, including constructing the URLs, http verbs and other aspects that could be encapsulated in a higher level construct. Enter <a href="http://docs.angularjs.org/api/ngResource">Angular-Resource</a>, which provides a mechanism to define our API through Angular services that manage much of the lower level http requirements for us leaving simple ReSTful verbs to interact with the API.</p>
<p>To work with Angular-Resource (or ngResource), you simply define the mapping between your API endpoints and the parameters in the URL pattern (much like Django <code>urlpatterns</code>). Unfortunately, it’s not terribly easy to convert between Django and the ngResource definitions, so the DRY isn’t quite there.</p>
<p>When you define your resources (using <code>$resource</code>), you simple provide a url pattern, a list of default parameter mappings, and optionally some additional http methods. In our case, we want the resource for <code>User</code> to pull the <code>:username</code> parameter in the URL from the <code>username</code> field on our resource instance. <code>Post</code> and <code>Photo</code> use the <code>id</code> field on the instance accordingly as the primary key.</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.api'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'ngResource'</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>factory <span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$resource<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $resource <span class="token string">'/api/users/:username'</span><span class="token punctuation">,</span> <span class="token property">username</span><span class="token operator">:</span> <span class="token string">'@username'</span>
<span class="token punctuation">]</span>

app<span class="token punctuation">.</span>factory <span class="token string">'Post'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$resource<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $resource <span class="token string">'/api/posts/:id'</span><span class="token punctuation">,</span> <span class="token property">id</span><span class="token operator">:</span> <span class="token string">'@id'</span>
<span class="token punctuation">]</span>

app<span class="token punctuation">.</span>factory <span class="token string">'Photo'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$resource<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $resource <span class="token string">'/api/photos/:id'</span><span class="token punctuation">,</span> <span class="token property">id</span><span class="token operator">:</span> <span class="token string">'@id'</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Now that we’ve defined our api module, we can use it as a dependency in our controller module and inject those API resources as services that our controller can use to access the API. We add <code>example.api</code> as a dependent module and list any API resources as dependencies in our controller definition. By default, your resources have many of the basic CRUD methods including <code>query()</code> (for retrieving a collection), <code>get()</code> (for individual items), <code>save()</code>, <code>delete()</code>, and so on.</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.app.resource'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'example.api'</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>controller <span class="token string">'AppController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span> <span class="token string">'Post'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $scope<span class="token punctuation">.</span>posts <span class="token operator">=</span> Post<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Which results in the same list of Posts as above on the <a href="http://localhost:8000/resource">example page</a>.</p>
<p><img alt="Basic Post List - Resource" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="266" src="/assets/example_resource._KtYmnTG_Zg3iPb.webp" ></p>
<h3 id="add-the-photos-to-our-post-feed">Add the Photos to our Post Feed</h3>
<p>We now have our feed of posts displaying using <code>ngResource</code> API calls, but we’re simply making one call to retrieve the data. In real applications, your data is rarely stored at only a single resource endpoint and will require coordinated API calls to construct your applications model state. Let’s enhance our app to also retrieve the photos from each post and display them as well to explore this.</p>
<p>First, let’s add two other resources for the nested API calls:</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app<span class="token punctuation">.</span>factory <span class="token string">'UserPost'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$resource<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $resource <span class="token string">'/api/users/:username/posts/:id'</span>
<span class="token punctuation">]</span>

app<span class="token punctuation">.</span>factory <span class="token string">'PostPhoto'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$resource'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$resource<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $resource <span class="token string">'/api/posts/:post_id/photos/:id'</span>
<span class="token punctuation">]</span>
</code></pre>
<p>This will provide two more services (<code>UserPost</code> and <code>PostPhoto</code>) that we can query to retrieve resources for a given user and post respectively. As nested resources, we want to wire up AngularJS to load them after loading the base resource (another option is to use angular’s <code>$watch</code> mechanism to response to changes and trigger additional API calls). For this, we want to leverage Angular’s <code>$q</code> service which provides a Promise/Deferred implementation allowing us to chain calls. Starting with ngResource-1.1+, each resource provides a $promise attribute which you can chain against. We are going to leverage that interface to make a follow on API call to retrieve photos for a given post.</p>
<p>You have a couple of choices on how to handle the nesting of resources. For this case, we will simply create another container on our <code>$scope</code> for the photos and use the post_id as the identifier. Angular’s expression and template language ignores missing keys, so we can simply iterate over <code>photos[post.id]</code> to retrieve the photos in the template. Notice how we don’t have to signal to change the view/template. Angular’s <code>$digest</code> process detects the updates (it’s also well integrated with <code>ngResoruce</code> and <code>$q</code>s).</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.app.photos'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'example.api'</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>controller <span class="token string">'AppController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span> <span class="token string">'Post'</span><span class="token punctuation">,</span> <span class="token string">'PostPhoto'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> Post<span class="token punctuation">,</span> PostPhoto<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $scope<span class="token punctuation">.</span>photos <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    $scope<span class="token punctuation">.</span>posts <span class="token operator">=</span> Post<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    $scope<span class="token punctuation">.</span>posts<span class="token punctuation">.</span>$promise<span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
        <span class="token comment"># Load the photos</span>
        angular<span class="token punctuation">.</span>forEach results<span class="token punctuation">,</span> <span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
            $scope<span class="token punctuation">.</span>photos<span class="token punctuation">[</span>post<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> PostPhoto<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token property">post_id</span><span class="token operator">:</span> post<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>And also update our template to iterate over this model to display photos in each post. Notice how AngularJS re-renders the view as the data is loaded from the API. In this case, we are iterating over the photos object referenced by the id of the post we were iterating in the parent <code>ng-repeat</code>. We also used <code>ng-src</code> instead of <code>src</code> because it prevents browsers from attempting to load an image before the angular expression language has been evaluated (you’ll see 404s in your logs around can’t find: ‘/media/{{ photo.image }}’).</p>
<pre class="language-django" data-language="django"><code is:raw="" class="language-django"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>panel<span class="token punctuation">"</span></span> <span class="token attr-name">ng-repeat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post in posts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>panel-heading clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pull-left panel-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">post</span><span class="token punctuation">.</span><span class="token variable">title</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h3</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>author</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pull-right<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">post</span><span class="token punctuation">.</span><span class="token variable">author</span><span class="token punctuation">.</span><span class="token variable">username</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>author</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>well<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">post</span><span class="token punctuation">.</span><span class="token variable">body</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>photo<span class="token punctuation">"</span></span> <span class="token attr-name">ng-repeat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>photo in photos[post.id]<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>img</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>img-thumbnail<span class="token punctuation">"</span></span> <span class="token attr-name">ng-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">photo</span><span class="token punctuation">.</span><span class="token variable">image</span> <span class="token delimiter punctuation">}}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>And finally, our updated <a href="http://localhost:8000/photos">example page</a> rendered with photos.</p>
<p><img alt="Basic Post List - Photos" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="400" src="/assets/example_photos.CUXDeXgI_dGVLj.webp" ></p>
<h3 id="interlude-angularjs--csrf-protection">Interlude: AngularJS + CSRF Protection</h3>
<p>Django Rest Framework extends Django’s <a href="https://docs.djangoproject.com/en/dev/ref/contrib/csrf/">Cross Site Request Forgery</a> protection when using <code>SessionAuthentication</code> (such as our case using the same browser session as the web application). This helps ensure malicious scripts can’t coax our users into making inadvertent calls to our API by forcing the scripts to return a server provided token on each call. AngularJS’s modular architecture and dependency injection configuration make this simple to configure our API calls to include the CSRF Token in a header (you can also use a cookie if you prefer).</p>
<p>In our django template, simply add a <code>&#x3C;script></code> tag to configure the <code>$http</code> provider (AngularJS parlance for the implementation of the <code>$http</code> dependency) and customize it to use the Django <code>{{ csrf_token }}</code> template variable to set the CSRF Header on all API calls.</p>
<p>*Note: Make sure this script is loaded <strong>after</strong> your module definitions.</p>
<p>*Note: You can pass the CSRF token between Angular and Django through cookies or other mechanisms. This explicit header mechanism just ensures the <code>csrf token</code> is generated on every request.</p>
<pre class="language-html" data-language="html"><code is:raw="" class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// Add the CSRF Token</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'example.app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Not including a list of dependent modules (2nd parameter to `module`) "re-opens" the module for additional configuration</span>
    app<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string">'$httpProvider'</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">$httpProvider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            $httpProvider<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'X-CSRFToken'</span><span class="token punctuation">]</span> <span class="token operator">=</span>
                <span class="token string">'{{ csrf_token|escapejs }}'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
</code></pre>
<h2 id="creatingmodifying-api-resource-using-angularjs">Creating/Modifying API Resource using AngularJS</h2>
<p>Let’s now build an editor in our feed view to publish a new post (such as a Facebook status update). While most Angular tutorials would just add the functionality to the existing controller on the page, we want to show how to keep your controllers lean and modular, so we’ll create a separate controller for this post editor and show how controllers leverage the nesting of the model scopes to extend functionality. This also gives a chance to extend our existing module <code>example.app.photos</code> which provides our base <code>AppController</code> for the feed.</p>
<p>First, we need to extend our base template, and add the html template for the editor. We also add the CSRF token from the above instructions since we’ll now send unsafe methods to our API to save the new posts.</p>
<pre class="language-django" data-language="django"><code is:raw="" class="language-django"><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">extends</span> <span class="token string">'base.html'</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">ng_app</span> <span class="token delimiter punctuation">%}</span></span>example.app.editor<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span>
<span class="token tag keyword">block</span> <span class="token variable">content</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">verbatim</span> <span class="token delimiter punctuation">%}</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">ng-controller</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>EditController<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>h5</span><span class="token punctuation">></span></span>Create a New Post<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>h5</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>form</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-inline<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group block-level<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>input</span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span>
                <span class="token attr-name">ng-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>newPost.title<span class="token punctuation">"</span></span>
                <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Title<span class="token punctuation">"</span></span>
            <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>input</span>
                <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>
                <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-control<span class="token punctuation">"</span></span>
                <span class="token attr-name">ng-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>newPost.body<span class="token punctuation">"</span></span>
                <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Body<span class="token punctuation">"</span></span>
            <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form-group<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default<span class="token punctuation">"</span></span> <span class="token attr-name">ng-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>save()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Add Post<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>form</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endverbatim</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">block</span><span class="token punctuation">.</span><span class="token variable">super</span> <span class="token delimiter punctuation">}}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">js</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">block</span><span class="token punctuation">.</span><span class="token variable">super</span>
<span class="token delimiter punctuation">}}</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// Add the CSRF Token</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'example.app.editor'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Not including a list of dependent modules (2nd parameter to `module`) "re-opens" the module for additional configuration</span>
    app<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token string">'$httpProvider'</span><span class="token punctuation">,</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$httpProvider</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            $httpProvider<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'X-CSRFToken'</span><span class="token punctuation">]</span> <span class="token operator">=</span>
                <span class="token string">'<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">csrf_token</span><span class="token operator">|</span><span class="token filter function">escapejs</span> <span class="token delimiter punctuation">}}</span></span>'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span>
</code></pre>
<p>Now, we have our editor, let’s build the controller to wire this up. Notice that we depend on two modules now, the base module for our feed and the api module that contains all our <code>$resource</code> definitions.</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.app.editor'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'example.api'</span><span class="token punctuation">,</span> <span class="token string">'example.app.photos'</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>controller <span class="token string">'EditController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span> <span class="token string">'Post'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>

    $scope<span class="token punctuation">.</span>newPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    $scope<span class="token punctuation">.</span>save <span class="token operator">=</span> <span class="token operator">-</span><span class="token operator">></span>
        $scope<span class="token punctuation">.</span>newPost<span class="token punctuation">.</span><span class="token function">$save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
            $scope<span class="token punctuation">.</span>posts<span class="token punctuation">.</span>push result
        <span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token operator">-</span><span class="token operator">></span>
            <span class="token comment"># Reset our editor to a new blank post</span>
            $scope<span class="token punctuation">.</span>newPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>

</code></pre>
<p>Previously, in the API Views, we added some permission constraints to prevent other users from modifying someone’s posts. Up until now, it didn’t matter what user were acting as. Now that we want to create users, we need to ensure that we’re authenticated as a valid user (or our API request to create a post will be denied). For this demonstration, there’s a quick hack Django Authentication Backend that automatically logs you in root. Obviously, don’t run this in production or any untrusted environment. This is just to help test our sandbox app without dealing with user registration and authentication.</p>
<p><img alt="Basic Post List - Editor" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="400" src="/assets/example_editor.CR69np55_Z291Paq.webp" ></p>
<h3 id="error-handling">Error Handling</h3>
<p>If you’re following along, have you tried creating a post without a title? We set that as a required field in the Django model, and Django Rest Framework will validate before creating the resource. If you try to create a Post without a title (say, using the API Browser or our new form), you’d see a 400 Bad Request response, with content that the reasons for the failed request. Let’s leverage that response to inform the user.</p>
<pre class="language-json" data-language="json"><code is:raw="" class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"This field is required."</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>To inform the user, let’s amend our API call. Since we’re using Promises, we can simply add an error callback to capture that response and notify the user by capturing the response in our <code>$scope</code> which our template can them update to show the messages to the user.</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.app.editor'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'example.api'</span><span class="token punctuation">,</span> <span class="token string">'example.app.photos'</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>controller <span class="token string">'EditController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span> <span class="token string">'Post'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> Post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>

    $scope<span class="token punctuation">.</span>newPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    $scope<span class="token punctuation">.</span>save <span class="token operator">=</span> <span class="token operator">-</span><span class="token operator">></span>
        $scope<span class="token punctuation">.</span>newPost<span class="token punctuation">.</span><span class="token function">$save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
            $scope<span class="token punctuation">.</span>posts<span class="token punctuation">.</span>push result
        <span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token operator">-</span><span class="token operator">></span>
            <span class="token comment"># Reset our editor to a new blank post</span>
            $scope<span class="token punctuation">.</span>newPost <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token operator">-</span><span class="token operator">></span>
            <span class="token comment"># Clear any errors</span>
            $scope<span class="token punctuation">.</span>errors <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">,</span> <span class="token punctuation">(</span>rejection<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
            $scope<span class="token punctuation">.</span>errors <span class="token operator">=</span> rejection<span class="token punctuation">.</span>data
<span class="token punctuation">]</span>
</code></pre>
<p>And also update our template to include a handy error display:</p>
<pre class="language-django" data-language="django"><code is:raw="" class="language-django"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span> <span class="token attr-name">ng-repeat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(name, errs) in errors<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>alert alert-danger<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>strong</span><span class="token punctuation">></span></span><span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">name</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>strong</span><span class="token punctuation">></span></span>: <span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">errs</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
</code></pre>
<p>By leveraging promise APIs, it makes it straightforward to add UI elements to give feedback about the progress (loading indicators, progress bars) by simply chaining them. AngularJS has a fairly complete Promises/A spec ensuring errors (or rejections) fall-through the chain making error handling simpler.</p>
<p>For this simple demonstration, we just enumerate the errors in bootstrap alert boxes. Because the errors are identified by attribute name, you can easily update your template to show errors in-line next the form fields they correspond with.</p>
<p><img alt="Basic Post List - Error" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="400" src="/assets/example_error.D3y4bnCe_2mX3h3.webp" ></p>
<h3 id="remove-your-posts">Remove Your Posts</h3>
<p>To compliment the editor, we need a way to delete any posts, but only added by the current user. We already instrumented the API to prevent users from trying to modify/delete resources they don’t own. When you’re new to AngularJS, the modular nature makes it difficult to understand how to provide some initial data to the controller. In our case, we need to know who the current user is, so we can control what posts are available to be deleted.</p>
<p>The key to understanding this is to try to de-compose your controllers into many services/factories (they’re basically synonymous in angular) that handle the actual logic. The controller (much like a view in Django) should really only focus on wiring together different components. In Django, you attempt to integrate as much of your business logic in the model (the fat-model pattern). In Angular, you similarly want to compartmentalize your logic into composable services.</p>
<p>To add the ability to remove posts, let’s first add a module extending our editor and adding an extra controller for handling the removal. We will depend on a service named <code>AuthUser</code> which the template will provide with the current user from the Django template context. In this case, it will simply contain a single <code>username</code> attribute for the current user (our empty if no user). We added two functions on the scope, <code>canDelete</code> to determine if a given post can be removed by the user, and <code>delete</code> to remove the post. Both take a <code>post</code> argument which we will supply in our template.</p>
<p>Again, we used the Promises interface of the <code>$resource</code> and only after successful confirmation from the server do we remove the post from our feed view. As above, there’s opportunity for capturing failure results and providing feedback to the user that we’ve skipped in this simple example.</p>
<pre class="language-coffeescript" data-language="coffeescript"><code is:raw="" class="language-coffeescript">app <span class="token operator">=</span> angular<span class="token punctuation">.</span>module <span class="token string">'example.app.manage'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'example.api'</span><span class="token punctuation">,</span> <span class="token string">'example.app.editor'</span><span class="token punctuation">]</span>

app<span class="token punctuation">.</span>controller <span class="token string">'DeleteController'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'$scope'</span><span class="token punctuation">,</span> <span class="token string">'AuthUser'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>$scope<span class="token punctuation">,</span> AuthUser<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
    $scope<span class="token punctuation">.</span>canDelete <span class="token operator">=</span> <span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
        <span class="token keyword">return</span> post<span class="token punctuation">.</span>author<span class="token punctuation">.</span>username <span class="token operator">==</span> AuthUser<span class="token punctuation">.</span>username

    $scope<span class="token punctuation">.</span><span class="token keyword">delete</span> <span class="token operator">=</span> <span class="token punctuation">(</span>post<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span>
        post<span class="token punctuation">.</span>$<span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">then</span> <span class="token operator">-</span><span class="token operator">></span>
            <span class="token comment"># Remove it from the list on success</span>
            idx <span class="token operator">=</span> $scope<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>post<span class="token punctuation">)</span>
            $scope<span class="token punctuation">.</span>posts<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>With the controller defined, let’s update our Post template to include a close button (with the condition that <code>canDelete</code> is true).</p>
<pre class="language-django" data-language="django"><code is:raw="" class="language-django"><span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">extends</span> <span class="token string">'editor.html'</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">ng_app</span> <span class="token delimiter punctuation">%}</span></span>example.app.manage<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">post_header</span> <span class="token delimiter punctuation">%}</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>button</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span>
    <span class="token attr-name">ng-controller</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>DeleteController<span class="token punctuation">"</span></span>
    <span class="token attr-name">ng-click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete(post)<span class="token punctuation">"</span></span>
    <span class="token attr-name">ng-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>canDelete(post)<span class="token punctuation">"</span></span>
<span class="token punctuation">></span></span>
    <span class="token entity named-entity" title="×">&#x26;times;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>button</span><span class="token punctuation">></span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">block</span><span class="token punctuation">.</span><span class="token variable">super</span> <span class="token delimiter punctuation">}}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">block</span> <span class="token variable">js</span> <span class="token delimiter punctuation">%}</span></span> <span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">block</span><span class="token punctuation">.</span><span class="token variable">super</span> <span class="token delimiter punctuation">}}</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// Configure the current user</span>
    <span class="token keyword">var</span> app <span class="token operator">=</span> angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">'example.app.manage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Not including a list of dependent modules (2nd parameter to `module`) "re-opens" the module for</span>

    app<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token string">'AuthUser'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">"<span class="token django language-django"><span class="token delimiter punctuation">{{</span> <span class="token variable">user</span><span class="token punctuation">.</span><span class="token variable">username</span><span class="token operator">|</span><span class="token filter function">default</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token operator">|</span><span class="token filter function">escapejs</span> <span class="token delimiter punctuation">}}</span></span>"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
<span class="token django language-django"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endblock</span> <span class="token delimiter punctuation">%}</span></span>
</code></pre>
<p>And, when you load the <a href="http://localhost:8000/manage">example page</a>, there’s an <em>‘X’</em> next to the post by <code>root</code>, but not next to the post by <code>bob</code>. Clicking the X calls our API and deletes the post.</p>
<p><img alt="Basic Post List - Removal" loading="lazy" decoding="async" fetchpriority="auto" width="400" height="600" src="/assets/example_managed.DxRQZGrx_ZfxABw.webp" ></p>
<p>And with that, we have a simple shared feed for a users to share messages.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Alright, let’s reflect. With a small amount of code (~100 lines of frontend, ~200 lines of backend), leveraging Django Rest Frameowrk (+Django itself) and AngularJS, we were able to quickly create a sample application to create simple postings. DRF makes it simple to export our Django data models through a ReSTful API layer with opportunities to customize the interfaces based on our use cases. AngularJS makes it easier to consume and interact with the API in a manner that is more modular and structured to help us add incremental capability to our web apps without creating spaghetti code.</p>
<p>All the code referenced in this article is available on a <a href="https://github.com/kevinastone/django-api-rest-and-angular">GitHub project</a>. You’re encouraged to checkout the repository and setup your own working copy to experiment. If you see any mistakes, please leave an Issue (or better yet, a Pull-Request) and I’ll be sure to correct it. If you have any questions, please leave me a comment (or hit me up on Twitter at <a href="https://twitter.com/kevinastone">@kevinastone</a>). I intend to follow this article up with more solutions for DRF+Angular that I’ve come across, including:</p>
<ul>
<li>Pagination</li>
<li>Singleton Endpoints (toggle follow/unfollow)</li>
<li>More Complex Permissions</li>
<li>Richer Validation</li>
<li>Testing</li>
</ul> <section><script>(()=>{var a=(s,i,o)=>{let r=async()=>{await(await s())()},t=typeof i.value=="object"?i.value:void 0,c={rootMargin:t==null?void 0:t.rootMargin},n=new IntersectionObserver(e=>{for(let l of e)if(l.isIntersecting){n.disconnect(),r();break}},c);for(let e of o.children)n.observe(e)};(self.Astro||(self.Astro={})).visible=a;window.dispatchEvent(new Event("astro:visible"));})();</script><astro-island uid="ZYeDtH" prefix="r3" component-url="/assets/Disqus.ZXPp-emh.js" component-export="default" renderer-url="/assets/client.Bfkaqq2T.js" props="{&quot;id&quot;:[0,&quot;django-rest-framework-and-angular-js&quot;],&quot;title&quot;:[0,&quot;Getting Started with Django Rest Framework and AngularJS&quot;],&quot;shortname&quot;:[0,&quot;kevinstone&quot;]}" ssr client="visible" opts="{&quot;name&quot;:&quot;Disqus&quot;,&quot;value&quot;:true}" await-children><div id="disqus_thread"></div><!--astro:end--></astro-island></section> </article>   </div> </main> <footer data-astro-cid-sz7xmlte> <div class="fixed-width">  <p data-astro-cid-sz7xmlte>&copy; Kevin A. Stone 2026, Built with <a href="https://astro.build/" data-astro-cid-sz7xmlte>Astro</a></p>  </div> </footer>  </body></html>